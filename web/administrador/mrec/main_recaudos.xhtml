<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

   <h:head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Facelets Template</title>
   </h:head>
   <h:body>
      <h:form id="form">
         
         <p:growl id="msgs" showDetail="true"/>
         
         <h:panelGrid columns="2" cellpadding="5">
            <p:selectOneMenu id="year" value="#{recaudosController.year}" style="width: 100px;">
               <p:ajax listener="#{recaudosController.onYearChange}" update="month"/>
               <f:selectItems value="#{recaudosController.years}"/>
            </p:selectOneMenu>
            <p:selectOneMenu id="month" value="#{recaudosController.month}" style="width: 100px;">
               <f:selectItems value="#{recaudosController.months}"/>
            </p:selectOneMenu>
         </h:panelGrid>
         
         
         <p:dataTable id="tblRecaudos" var="recaudo" value="#{recaudosController.recaudos}" widgetVar="recaudosTable"
                      emptyMessage="No se han encontrado registros" rowIndexVar="rowIndex"
                      filteredValue="#{recaudosController.recaudosFiltered}"
                      styleClass="recaudoTable"
                      rowStyleClass="#{recaudo.fechaLimite.date lt recaudosController.day and (recaudo.estado ne 'Pagado') ? 'fechaRed' : null}">
            
            <f:facet name="header">
               <p:outputPanel>
                  <p:inputText id="globalFilter" onkeyup="PF('recaudosTable').filter()" 
                               placeholder="Busca por cualquiera de los campos"
                               style="width: 350px; text-align: center;"/>
                  <h:outputText value="Mostrando datos de #{recaudosController.month} del #{recaudosController.year}"
                                style="float: left; margin-top: 7px"/>
               </p:outputPanel>
            </f:facet>
            
            <p:column headerText="No." width="20">
               <h:outputText value="#{rowIndex+1}" />
            </p:column>

            <p:column headerText="Documento" 
                      filterBy="#{recaudo.usuario.usuIdentificacion}" filterMatchMode="contains">
               <h:outputText value="#{recaudo.usuario.usuIdentificacion}" />
            </p:column>

            <p:column headerText="Referencia"
                      filterBy="#{recaudo.recibo.rpagReferencia}" filterMatchMode="contains">
               <h:outputText value="#{recaudo.recibo.rpagReferencia}" />
            </p:column>

            <p:column headerText="Fecha limite"
                      filterBy="#{recaudo.strFechaLimite}" filterMatchMode="contains">
               <h:outputText value="#{recaudo.strFechaLimite}" />
            </p:column>

            <p:column headerText="Estado de pago"
                      filterBy="#{recaudo.estado}" filterMatchMode="equals">
               <f:facet name="filter">
                  <p:selectOneMenu onchange="PF('recaudosTable').filter()" style="font-size: 10px">
                     <f:selectItem itemLabel="Todos" itemValue="" />
                     <f:selectItem itemLabel="Sin recibo" itemValue="Sin recibo" />
                     <f:selectItem itemLabel="Por pagar" itemValue="Por pagar" />
                     <f:selectItem itemLabel="Pagado" itemValue="Pagado" />
                  </p:selectOneMenu>
               </f:facet>
               <h:outputText value="#{recaudo.estado}" />
            </p:column>

            <p:column headerText="Conf." width="30">
               <p:commandButton update=":form:recaudoDetail" oncomplete="PF('recaudoDialog').show()" 
                                icon="ui-icon-plus" title="Generar recibo"
                                rendered="#{(recaudo.estado eq 'Sin recibo') and (recaudo.fechaLimite.date ge recaudosController.day)}">
                  <f:setPropertyActionListener value="#{recaudo}" target="#{recaudosController.recaudoSelected}"/>
               </p:commandButton>
               <p:commandButton update=":form:recaudoDetail" oncomplete="PF('confirmPagoDialog').show()" 
                                icon="ui-icon-check" title="Confirmar Pago"
                                rendered="#{(recaudo.estado eq 'Por pagar') and (recaudo.fechaLimite.date ge recaudosController.day)}">
                  <f:setPropertyActionListener value="#{recaudo}" target="#{recaudosController.recaudoSelected}"/>
               </p:commandButton>
            </p:column>
            
            <p:column headerText="Acciones">
               <p:commandButton update=":form:recaudoDetail" oncomplete="PF('viewRecaudoDialog').show()" 
                                icon="ui-icon-search" title="Ver">
                  <f:setPropertyActionListener value="#{recaudo}" target="#{recaudosController.recaudoSelected}"/>
               </p:commandButton>
               <p:commandButton update=":form:recaudoDetail" oncomplete="PF('recaudoDialog').show()" 
                                icon="ui-icon-pencil" title="Editar">
                  <f:setPropertyActionListener value="#{recaudo}" target="#{recaudosController.recaudoSelected}"/>
               </p:commandButton>
               <p:commandButton oncomplete="PF('deleteRecaudoDialog').show()" 
                                icon="ui-icon-close" title="Eliminar">
                  <f:setPropertyActionListener value="#{recaudo}" target="#{recaudosController.recaudoSelected}"/>
               </p:commandButton>
            </p:column>
         </p:dataTable>
         
         <p:dialog header="Informacion de Recaudo" widgetVar="viewRecaudoDialog"
                   modal="true" showEffect="fade" hideEffect="fade"
                   resizable="false">
            <p:outputPanel id="recaudoDetail" style="text-align: center;">
               <p:panelGrid columns="2" rendered="#{not empty recaudosController.recaudoSelected}"
                            columnClasses="label,value">       
                  
               </p:panelGrid>
            </p:outputPanel>
         </p:dialog>
         
         <p:dialog header="¿Esta seguro que desea eliminar este recaudo?" widgetVar="deleteRecaudoDialog"
                   modal="true" showEffect="fade" hideEffect="fade" resizable="false">
            <p:outputPanel style="text-align: center;">
               <h:panelGrid columns="2">
                  <p:commandButton value="Si" actionListener="#{recaudosController.deleteRecaudo()}"
                                   icon="ui-icon-check" update=":form:tblRecaudos :form:msgs"
                                   oncomplete="PF('deleteRecaudoDialog').hide()" />
                  <p:commandButton value="No" icon="ui-icon-close" 
                                   oncomplete="PF('deleteRecaudoDialog').hide()"/>
               </h:panelGrid>
            </p:outputPanel>
         </p:dialog>
         
         <p:dialog header="¿Esta seguro que desea confirmar el pago?" widgetVar="confirmPagoDialog"
                   modal="true" showEffect="fade" hideEffect="fade" resizable="false">
            <p:outputPanel style="text-align: center;">
               <h:panelGrid columns="2">
                  <p:commandButton value="Si" actionListener="#{recaudosController.deleteRecaudo()}"
                                   icon="ui-icon-check" update=":form:tblRecaudos :form:msgs"
                                   oncomplete="PF('confirmPagoDialog').hide()" />
                  <p:commandButton value="No" icon="ui-icon-close" 
                                   oncomplete="PF('confirmPagoDialog').hide()"/>
               </h:panelGrid>
            </p:outputPanel>
         </p:dialog>
                          
      </h:form>
   </h:body>
</html>
